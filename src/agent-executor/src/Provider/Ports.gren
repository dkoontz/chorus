port module Provider.Ports exposing
    ( createSession
    , sendMessage
    , submitToolResults
    , resumeSession
    )

{-| Task ports for the Claude Code SDK bridge.

These ports connect to the TypeScript SDK bridge that wraps
the Claude Code SDK. Each port is a Task that sends data to
JavaScript and receives a response.
-}

import Json.Decode
import Task exposing (Task)


{-| Create a new session with the Claude Code SDK.

Input: { agentSpec: { name, systemPrompt }, workspaceRoot }
Output: { sessionId } or error
-}
port createSession :
    { agentSpec : { name : String, systemPrompt : String }
    , workspaceRoot : String
    }
    -> Task Json.Decode.Value String


{-| Send a message in an existing session.

Input: { sessionId, message }
Output: { response, toolCalls, isComplete } or error
-}
port sendMessage :
    { sessionId : String
    , message : String
    }
    -> Task Json.Decode.Value String


{-| Submit tool results and get the next response.

Input: { sessionId, results: [{ toolCallId, output, isError }] }
Output: { response, toolCalls, isComplete } or error
-}
port submitToolResults :
    { sessionId : String
    , results :
        Array
            { toolCallId : String
            , output : String
            , isError : Bool
            }
    }
    -> Task Json.Decode.Value String


{-| Resume an existing session.

Input: { sessionId }
Output: { exists, lastMessage? } or error
-}
port resumeSession :
    { sessionId : String
    }
    -> Task Json.Decode.Value String
